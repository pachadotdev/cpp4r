<!DOCTYPE html>
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>07 - Statistical Functions ‚Ä¢ cpp4r</title><link rel="stylesheet" href="../menu.css"><link rel="stylesheet" href="../content.css"><!-- MathJax Configuration --><script>
    window.MathJax = {
      tex: {
        inlineMath: [['\\(', '\\)'], ['$', '$']],
        displayMath: [['\\[', '\\]'], ['$$', '$$']],
        processEscapes: true,
        processEnvironments: true,
        packages: {'[+]': ['ams', 'newcommand', 'configmacros']}
      },
      options: {
        ignoreHtmlClass: 'tex2jax_ignore',
        processHtmlClass: 'tex2jax_process'
      }
    };
  </script><script id="MathJax-script" async src="../js/tex-svg.js"></script></head><body>
<div class="main-container">
<div id="menu">
  <div>
    <img src="../man/figures/logo.svg" align="center" height="139" alt="cpp4r logo"></div>

  <div class="search-container">
    <input type="text" id="search-box" placeholder="Search..."></div>

  <div class="search-container">
    <button id="theme-toggle" title="Toggle dark mode" aria-label="Toggle dark mode">Toggle theme</button>
    <button id="font-decrease" title="Decrease font size" aria-label="Decrease font size">A-</button>
    <button id="font-increase" title="Increase font size" aria-label="Increase font size">A+</button>
  </div>

  <div class="submenu">
    <label style="border-bottom: 0;"><a style="padding-left: 0;" href="../index.html">Home üè†</a></label>
  </div>

  <div class="submenu">
    <label>Functions</label>
    <a href="../reference/register.html">register</a>
    <a href="../reference/pkg_template.html">pkg_template</a>
    <a href="../reference/unvendor.html">unvendor</a>
    <a href="../reference/vendor.html">vendor</a>
  </div>

  <div class="submenu">
    <label>Vignettes</label>
    <a href="../vignettes/01-intro.html">01 - Introduction</a>
    <a href="../vignettes/02-setup.html">02 - Setup</a>
    <a href="../vignettes/03-package-skeleton.html">03 - Package Skeleton</a>
    <a href="../vignettes/04-read-only.html">04 - Read-only versus Writable R Objects</a>
    <a href="../vignettes/05-logical-functions.html">05 - Logical Functions</a>
    <a href="../vignettes/06-rolling-functions.html">06 - Rolling Functions</a>
    <a href="../vignettes/07-statistical-functions.html">07 - Statistical Functions</a>
    <a href="../vignettes/08-logical-functions-2.html">08 - Logical Functions with Missing Values</a>
    <a href="../vignettes/09-rolling-functions-2.html">09 - Rolling Functions with Missing Values</a>
    <a href="../vignettes/10-statistical-functions-2.html">10 - Statistical Functions with Missing Values</a>
    <a href="../vignettes/11-debugging.html">11 - Debugging R Packages</a>
    <a href="../vignettes/12-external-pointers.html">12 - External Pointers</a>
    <a href="../vignettes/13-compiler-optimization.html">13 - Compiler Optimizations</a>
    <a href="../vignettes/14-linear-algebra.html">14 - Linear Algebra</a>
    <a href="../vignettes/15-internals.html">15 - Internals</a>
    <a href="../vignettes/16-FAQ.html">17 - FAQs</a>
    <a href="../vignettes/17-worked-examples.html">16 - Worked Examples</a>
  </div>

  <div class="submenu">
    <label>News</label>
    <a href="../news/index.html">Changelog</a>
  </div>
</div>
<div id="content">
<div class="content-wrapper">
        <div class="content-main">
          <h1>07 - Statistical Functions</h1>



<div id="notes" class="section level2">
<h2>Notes</h2>
<ul><li>These functions ignore <code>NA</code> values for now. Adjustments
for handling <code>NA</code> values are covered in a separate
vignette.</li>
<li>R already provides efficient versions of the functions covered here.
This is just to illustrate how to use C++ code.</li>
<li>The explanations and equations used for the functions are taken from
<span class="citation">Diez et al. (2015)</span> and <span class="citation">Hansen (2022)</span>. Some examples were adapted from
<span class="citation">Vaughan, Hester, and Francois (2024)</span>.</li>
</ul></div>
<div id="sum" class="section level2">
<h2>Sum</h2>
<p>For a vector of <span class="math inline">\(n\)</span> elements <span class="math inline">\(x_1, x_2, \ldots, x_n\)</span>, the sum is
calculated as:</p>
<p><span class="math display">\[
\sum_{i=1}^{n} x_i = x_1 + x_2 + \ldots + x_n
\]</span></p>
<p>The following C++ function calculates the sum of a vector‚Äôs
elements:</p>
<pre class="cpp"><code>[[cpp4r::register]]
double sum_cpp(doubles x) {
  int n = x.size();
  double total = 0;
  for(int i = 0; i &lt; n; ++i) {
    total += x[i];
  }
  return total;
}</code></pre>
<p>Its R equivalent is:</p>
<pre class="r"><code>sum_r &lt;- function(x) {
  total &lt;- 0
  for (i in seq_along(x)) {
    total &lt;- total + x[i]
  }
  total
}</code></pre>
<p>Document the functions and update the package as in the previous
vignettes.</p>
<p>To test the functions, you can run the following benchmark code in
the R console:</p>
<pre class="r"><code># install.packages("bench")
library(bench)

set.seed(123) # for reproducibility
x &lt;- runif(1e3) # 1,000,000 elements

sum(x)
sum_cpp(x)
sum_r(x)

mark(
  sum(x),
  sum_cpp(x),
  sum_r(x)
)</code></pre>
</div>
<div id="arithmetic-mean" class="section level2">
<h2>Arithmetic mean</h2>
<p>The arithmetic mean of a vector of <span class="math inline">\(n\)</span> elements <span class="math inline">\(x_1, x_2, \ldots, x_n\)</span> is calculated
as:</p>
<p><span class="math display">\[
\bar{x} = \frac{1}{n} \sum_{i=1}^{n} x_i
\]</span></p>
<p>The following C++ function calculates the mean of a vector‚Äôs
elements:</p>
<pre class="cpp"><code>[[cpp4r::register]]
double mean_cpp(doubles x) {
  int n = x.size();
  double y = 0;

  for(int i = 0; i &lt; n; ++i) {
    y += x[i];
  }
  return y / n;
}</code></pre>
<p>Its R equivalent would be:</p>
<pre class="r"><code>mean_r &lt;- function(x) {
  sum_r(x) / length(x)
}</code></pre>
<p>Document the functions and update the package as in the previous
vignettes.</p>
<p>To test the functions, you can run the following benchmark code in
the R console:</p>
<pre class="r"><code>mean(x)
mean_cpp(x)
mean_r(x)

mark(
  mean(x),
  mean_cpp(x),
  mean_r(x)
)</code></pre>
</div>
<div id="variance" class="section level2">
<h2>Variance</h2>
<p>The variance of a vector of <span class="math inline">\(n\)</span>
elements <span class="math inline">\(x_1, x_2, \ldots, x_n\)</span> is
calculated as:</p>
<p><span class="math display">\[
\text{Var}(x) = \frac{1}{n-1} \sum_{i=1}^{n} (x_i - \bar{x})^2
\]</span></p>
<p>The following C++ function calculates the variance of a vector‚Äôs
elements:</p>
<pre class="cpp"><code>[[cpp4r::register]]
double var_cpp(doubles x) {
  int n = x.size();
  double y1 = 0, y2 = 0;

  for(int i = 0; i &lt; n; ++i) {
    y1 += x[i];
    y2 += pow(x[i], 2.0);
  }
  return (y2 - pow(y1, 2.0) / n) / (n - 1);
}</code></pre>
<p>Its R equivalent would be:</p>
<pre class="r"><code>var_r &lt;- function(x) {
  mean_r((x - mean_r(x))^2)
}</code></pre>
<p>Document the functions and update the package as in the previous
vignettes.</p>
<p>To test the functions, you can run the following benchmark code in
the R console:</p>
<pre class="r"><code>var(x)
var_cpp(x)
var_r(x)

mark(
  var(x),
  var_cpp(x),
  var_r(x)
)</code></pre>
</div>
<div id="root-mean-square-error-rmse" class="section level2">
<h2>Root Mean Square Error (RMSE)</h2>
<p>The RMSE function measures the differences between observed values
and the true value.</p>
<p>For a vector of <span class="math inline">\(n\)</span> elements <span class="math inline">\(x_1, x_2, \ldots, x_n\)</span> and a value <span class="math inline">\(x_0\)</span>, the RMSE is calculated as:</p>
<p><span class="math display">\[
\text{RMSE}(x, x_0) = \sqrt{\frac{1}{n} \sum_{i=1}^{n} (x_i - x_0)^2}
\]</span></p>
<p>The following C++ function calculates the difference of a vector‚Äôs
elements to a value and returns the square root of the mean of the
squared differences:</p>
<pre class="cpp"><code>[[cpp4r::register]]
double rmse_cpp(doubles x, double x0) {
  int n = x.size();
  double y = 0;
  for (int i = 0; i &lt; n; ++i) {
    y += pow(x[i] - x0, 2.0);
  }
  return sqrt(y / n);
}</code></pre>
<p>Its R equivalent would be:</p>
<pre class="r"><code>#' Return the root mean square error (R)
#' @param x numeric vector
#' @param x0 numeric value
#' @export
rmse_r &lt;- function(x, x0) {
  sqrt(sum((x - x0)^2) / length(x))
}</code></pre>
<p>Document the functions and update the package as in the previous
vignettes.</p>
<p>To test the functions, you can run the following benchmark code in
the R console:</p>
<pre class="r"><code># create a list with 100 normal distributions with mean 0 and 1 million elements
set.seed(123)
x &lt;- list()
for (i in 1:1e3) {
  x[[i]] &lt;- rnorm(1e3)
}

# compute the mean of each distribution
x &lt;- sapply(x, mean)

rmse_cpp(x, 0)
rmse_r(x, 0)

mark(
  rmse_cpp(x, 0),
  rmse_r(x, 0)
)</code></pre>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="unnumbered">References</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-diez15" class="csl-entry">
Diez, David, Mine Cetinkaya-Rundel, Christopher Barr, and OpenIntro.
2015. <em><span>OpenIntro</span> <span>Statistics</span></em>. Leanpub.
<a href="https://leanpub.com/os">https://leanpub.com/os</a>.
</div>
<div id="ref-hansen22" class="csl-entry">
Hansen, Bruce E. 2022. <em>Econometrics</em>. Princeton, New Jersey:
Princeton University Press.
</div>
<div id="ref-vaughan24" class="csl-entry">
Vaughan, Davis, Jim Hester, and Roman Francois. 2024. <span>‚ÄúGet Started
with Cpp11.‚Äù</span> <a href="https://cpp11.r-lib.org/articles/cpp11.html#intro">https://cpp11.r-lib.org/articles/cpp11.html#intro</a>.
</div>
</div>
</div>
        </div>
        <footer><p id="last-updated">Loading...</p>
</footer><script src="../js/footer.js"></script><script src="../js/theme.js"></script><script src="../js/search.js"></script><script src="../js/fontsize.js"></script></div>
</div>
</div>
</body></html>

