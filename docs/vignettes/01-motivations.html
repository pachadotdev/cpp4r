<!DOCTYPE html>
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>01 - Motivations for cpp4r ‚Ä¢ cpp4r</title><link rel="stylesheet" href="../menu.css"><link rel="stylesheet" href="../content.css"><!-- MathJax Configuration --><script>
    window.MathJax = {
      tex: {
        inlineMath: [['\\(', '\\)'], ['$', '$']],
        displayMath: [['\\[', '\\]'], ['$$', '$$']],
        processEscapes: true,
        processEnvironments: true,
        packages: {'[+]': ['ams', 'newcommand', 'configmacros']}
      },
      options: {
        ignoreHtmlClass: 'tex2jax_ignore',
        processHtmlClass: 'tex2jax_process'
      }
    };
  </script><script id="MathJax-script" async src="../js/tex-svg.js"></script></head><body>
<div class="main-container">
<div id="menu">
  <div>
    <img src="../man/figures/logo.svg" align="center" height="139" alt="cpp4r logo"></div>

  <div class="search-container">
    <input type="text" id="search-box" placeholder="Search..."></div>

  <div class="search-container">
    <button id="theme-toggle" title="Toggle dark mode" aria-label="Toggle dark mode">Toggle theme</button>
    <button id="font-decrease" title="Decrease font size" aria-label="Decrease font size">A-</button>
    <button id="font-increase" title="Increase font size" aria-label="Increase font size">A+</button>
  </div>

  <div class="submenu">
    <label style="border-bottom: 0;"><a style="padding-left: 0;" href="../index.html">Home üè†</a></label>
  </div>

  <div class="submenu">
    <label>Functions</label>
    <a href="../reference/register.html">register</a>
    <a href="../reference/pkg_template.html">pkg_template</a>
    <a href="../reference/unvendor.html">unvendor</a>
    <a href="../reference/vendor.html">vendor</a>
  </div>

  <div class="submenu">
    <label>Vignettes</label>
    <a href="../vignettes/01-motivations.html">01 - Motivations for cpp4r</a>
    <a href="../vignettes/02-setup.html">02 - Setup</a>
    <a href="../vignettes/03-package-skeleton.html">03 - Package Skeleton</a>
    <a href="../vignettes/04-read-only.html">04 - Read-only versus Writable R Objects</a>
    <a href="../vignettes/05-logical-functions.html">05 - Logical Functions</a>
    <a href="../vignettes/06-rolling-functions.html">06 - Rolling Functions</a>
    <a href="../vignettes/07-statistical-functions.html">07 - Statistical Functions</a>
    <a href="../vignettes/08-logical-functions-2.html">08 - Logical Functions with Missing Values</a>
    <a href="../vignettes/09-rolling-functions-2.html">09 - Rolling Functions with Missing Values</a>
    <a href="../vignettes/10-statistical-functions-2.html">10 - Statistical Functions with Missing Values</a>
    <a href="../vignettes/11-debugging.html">11 - Debugging R Packages</a>
    <a href="../vignettes/12-external-pointers.html">12 - External Pointers</a>
    <a href="../vignettes/13-compiler-optimization.html">13 - Compiler Optimizations</a>
    <a href="../vignettes/14-linear-algebra.html">14 - Linear Algebra</a>
    <a href="../vignettes/15-internals.html">15 - Internals</a>
    <a href="../vignettes/16-FAQ.html">17 - FAQs</a>
    <a href="../vignettes/17-worked-examples.html">16 - Worked Examples</a>
  </div>

  <div class="submenu">
    <label>News</label>
    <a href="../news/index.html">Changelog</a>
  </div>
</div>
<div id="content">
<div class="content-wrapper">
        <div class="content-main">
          <h1>01 - Motivations for cpp4r</h1>
<script src="libs/header-attrs-2.30/header-attrs.js"></script><h1 class="title toc-ignore">01 - Motivations for cpp4r</h1>



<div id="motivation-and-significance" class="section level2">
<h2>Motivation and significance</h2>
<p>The R programming language has maintained a long-standing tradition
of interfacing with compiled languages, dating back to the original S
implementation in the late 1970s, which served primarily as a wrapper
around FORTRAN routines <span class="citation">(Chambers 2006)</span>.
This integration remains relevant today, as R code sometimes lacks the
performance needed for computationally intensive tasks. Even after
optimizing R code through vectorization and avoiding unnecessary object
copying, bottlenecks may persist that require compiled language
solutions.</p>
<p>C++ offers particular advantages for addressing common R performance
bottlenecks, including:</p>
<ul><li>Loops that cannot be easily vectorized due to dependencies between
iterations</li>
<li>Recursive functions or problems requiring many function calls</li>
<li>Data structures and algorithms not natively available in R (e.g., R
does not let the end-user use pointers and pass-by-reference
semantics)</li>
<li>Problems requiring fine-tuning memory management</li>
</ul><p>cpp4r is an R package that provides C++11 bindings to R, enabling the
use of C++ code in R packages. It is a fork of the cpp11 package <span class="citation">(Vaughan, Hester, and Fran√ßois 2025)</span> aiming to
provide additional features and improvements while maintaining
compatibility with the original cpp11 API.</p>
<p>The landscape of C++ bindings for R has evolved significantly over
the past two decades. The cxx package, released in 2000, provided an
early prototype of C++ bindings <span class="citation">(Hornik
2001)</span>. Rcpp, first published to CRAN in 2008, became the
mainstream solution with over 2,000 reverse dependencies by 2020 <span class="citation">(Eddelbuettel and Francois 2011)</span>.</p>
<p>cpp11 was released in 2023 as a complete reimplementation of C++
bindings to R, with different design trade-offs compared to Rcpp aiming
to provide:</p>
<ul><li>Enforced copy-on-write semantics consistent with R‚Äôs behavior</li>
<li>Improved safety when interfacing with R‚Äôs C API</li>
<li>Native support for ALTREP objects</li>
<li>UTF-8 string handling throughout</li>
<li>Modern C++11 features and idioms</li>
<li>Simplified implementation compared to Rcpp</li>
<li>Faster compilation with reduced memory requirements</li>
<li>Completely header-only design to avoid Application Binary Interface
(ABI) compatibility issues</li>
</ul><p>However, cpp11 lacks some Rcpp features that explain its widespread
adoption, including:</p>
<ul><li>Syntactic sugar (e.g., helper functions that allow for a more
concise or convenient way to express common patterns)</li>
<li>Modules (e.g., helpers to export C++ functions and/or classes to R
more easily)</li>
<li>Attributes (e.g., decorators to expose C++ functions to R with
minimal boilerplate code)</li>
</ul></div>
<div id="software-description" class="section level1">
<h1>Software description</h1>
<p>While using cpp11 for my thesis project, I identified several
enhancements that could benefit the R community and improve the
library‚Äôs usability. These enhancements include:</p>
<ul><li>Support for converting C++ maps to R lists</li>
<li>Roxygen documentation support directly in C++ code</li>
<li>Proper handling of matrix attributes</li>
<li>Support for nullable external pointers</li>
<li>Immediate availability of values added via
<code>push_back()</code></li>
<li>Bidirectional copy of complex number types</li>
<li>Flexibility in type conversions</li>
<li>Various performance optimizations</li>
<li>Specialized codebase to benefit from newer C++ standards (e.g., if
C++20 is available, compiling a package will use C++20 features instead
of being limited to C++11)</li>
</ul><p>After discussing these proposed enhancements with the cpp11
maintainers, it became clear that the development priorities and
timelines would not accommodate these features in the near term. This
led to the creation of cpp4r, a fork of cpp11 that incorporates these
additional features while maintaining compatibility with the original
cpp11 API. This means that cpp4r can serve as a drop-in replacement for
cpp11 in any case, allowing users to benefit from the enhancements
without significant code changes. The converse, replacing cpp4r with
cpp11, requires adjustments due to the additional features in cpp4r.</p>
<p>cpp4r extends cpp11‚Äôs container support by enabling seamless
conversion between C++ standard library containers and R objects. This
includes support for <code>std::map</code> and
<code>std::unordered_map</code> containers, which are automatically
converted to named R lists.</p>
<p>cpp4r provides roxygen support directly in C++ code, allowing
developers to document their C++ functions using familiar roxygen2
syntax. This integration streamlines the documentation workflow for
packages that expose C++ functions to R.</p>
<p>Unlike cpp11, cpp4r properly handles matrix attributes, including
<code>dimnames</code>, ensuring that matrix operations preserve metadata
when copying data between R and C++.</p>
<p>cpp4r offers more flexible type conversion functions. For example,
<code>as_integers()</code> and <code>as_doubles()</code> accept logical
inputs, providing greater flexibility in handling diverse input types
compared to the more restrictive cpp11 implementations.</p>
<p>Several internal optimizations improve performance over cpp11,
particularly in vector operations and memory management. These
optimizations maintain the safety guarantees of cpp11 while improving
execution speed.</p>
<p>cpp4r provides full bidirectional copying of complex numbers,
enabling seamless transfer of complex vectors and matrices between R and
C++ code. In contrast, cpp11 does not support this functionality.</p>
<p>cpp4r maintains cpp11‚Äôs core design principles while extending
functionality:</p>
<ul><li>Copy-on-Write Semantics: Like cpp11, cpp4r enforces copy-on-write
semantics that match R‚Äôs behavior, preventing unexpected modifications
to input data.</li>
<li>Safety First: cpp4r incorporates comprehensive safety mechanisms
when interfacing with R‚Äôs C API, using <code>unwind_protect()</code> and
exception handling to prevent resource leaks.</li>
<li>Modern C++ Features: The implementation leverages C++11 features
including move semantics, type traits, variadic templates, and
user-defined literals.</li>
<li>Header-Only Design: As a completely header-only library, cpp4r
avoids ABI compatibility issues that can arise with libraries containing
compiled components.</li>
</ul><p>cpp4r offers vendoring capabilities, which means copying the
dependency code directly into your project‚Äôs source tree. This approach,
borrowed from the Go programming language, includes the dependencies‚Äô
headers with the source code <span class="citation">(The Go Authors
2024)</span>. This ensures the dependency code remains fixed and stable
until explicitly updated. Since cpp4r is a header-only library, you can
copy all headers by running <code>cpp4r::vendor_cpp4r()</code> when
needed.</p>
<p>Vendoring has both advantages and drawbacks. The main advantage is
that disruptive changes to the cpp4r project cannot break your existing
code. The drawbacks include slightly larger package size and isolation
from bugfixes and new features until you explicitly update the vendored
headers. Most packages should not vendor the cpp4r dependency, except
for projects designed to run in restricted environments where internet
access is limited or unavailable for security reasons (e.g.,
high-performance computing clusters).</p>
</div>
<div id="software-functionalities" class="section level1">
<h1>Software functionalities</h1>
<p>cpp4r is designed as a drop-in replacement for cpp11, using identical
syntax and API patterns. Existing cpp11 code can typically be migrated
to cpp4r with minimal changes, primarily involving header includes and
namespace references.</p>
<p>To use cpp4r, users must first install the package from CRAN or
GitHub. The following code shows how to install the package:</p>
<pre class="r"><code>install.packages("cpp4r", repos = "https://cran.rstudio.com")

# or
remotes::install_github("pachadotdev/cpp4r")</code></pre>
<p>Once installed, users can use the provided package template function
to create a new package that uses C++ code. The package template
includes simple examples and all the necessary files to compile the code
and install the new R package. The following code shows how to create a
new package:</p>
<pre class="r"><code>cpp4r::pkg_template("~/rstats/mypkg")</code></pre>
<p>The package skeleton includes standard practices:</p>
<pre class="r"><code># In DESCRIPTION file
LinkingTo: cpp4r

# In R code
#' @useDynLib mypkg, .registration = TRUE
#' @keywords internal
"_PACKAGE"</code></pre>
<p>C++ functions are exposed to R using the attribute syntax and
documented with roxygen comments:</p>
<pre class="cpp"><code>/* roxygen
@title Square of Each Element in 'x'
@param x Numeric vector
@return Numeric vector
@export
*/
[[cpp4r::register]]
cpp4r::doubles my_square(cpp4r::doubles x) {
  return x * x;
}</code></pre>
<p>The equivalent cpp11 code would be:</p>
<pre class="cpp"><code>[[cpp11::register]]
cpp11::doubles my_square_cpp(cpp11::doubles x) {
  return x * x;
}</code></pre>
<pre class="r"><code>#' @title Square of Each Element in 'x'
#' @param x Numeric vector
#' @return Numeric vector
#' @export
my_square &lt;- function(x) {
  my_square_cpp(x)
}</code></pre>
</div>
<div id="benchmarks" class="section level1">
<h1>benchmarks</h1>
<p>TODO.</p>
</div>
<div id="impact" class="section level1">
<h1>Impact</h1>
<p>By providing a portable interface for C++ integration, cpp4r enables
R developers to leverage the power of modern C++ while minimizing the
complexity typically associated with writing compiled code. The
benchmarks demonstrate substantial speed and memory usage improvements
compared to existing implementations, providing researchers with a
useful tool to write R packages to analyze large datasets and intensive
computations.</p>
<p>Beyond improved memory usage, which can determine whether an analysis
is feasible, cpp4r‚Äôs design also offers faster compilation times,
enhancing development workflow and testing. This is particularly
beneficial in academic and business settings, where prototyping and
iteration are common before final implementation.</p>
<p>cpp4r represents an evolution in C++ bindings for R, building upon
the solid foundation established by cpp11 while addressing specific
limitations and adding features that can benefit the R community. By
maintaining API compatibility with cpp11, cpp4r provides a migration
path for developers seeking enhanced functionality without requiring
significant code restructuring.</p>
</div>
<div id="conclusion" class="section level1">
<h1>Conclusion</h1>
<p>The development of cpp4r demonstrates the value of open-source
transparency and how it enables derived works. While cpp11 and Rcpp
continue to serve the broader R community effectively, cpp4r offers an
alternative for projects requiring its specific enhancements,
particularly in academic research contexts where documentation features
and additional data types support reduce the coding effort for advancing
computational methods.</p>
<p>The software, documentation, and replication code are available on <a href="https://github.com/pachadotdev/cpp4r">GitHub</a>. The codebase is
released under the Apache 2.0 license. Contributions and feedback from
the R community are welcome to help improve the package further. We hope
that cpp4r will be a valuable tool for R developers, providing a simple
solution for performance bottlenecks by integrating C++ code into R
packages.</p>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="unnumbered">References</h1>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-chambers06" class="csl-entry">
Chambers, John. 2006. <span>‚ÄúA <span>History</span> of <span>S</span>
and <span>R</span> (with Some Questions for the Future).‚Äù</span> Vienna,
Austria. <a href="https://www.r-project.org/conferences/useR-2006/Presentations/index.html">https://www.r-project.org/conferences/useR-2006/Presentations/index.html</a>.
</div>
<div id="ref-eddelbuettel11" class="csl-entry">
Eddelbuettel, Dirk, and Romain Francois. 2011. <span>‚ÄúRcpp:
<span>Seamless</span> <span>R</span> and <span>C++</span>
<span>Integration</span>.‚Äù</span> <em>Journal of Statistical
Software</em> 40 (April): 1‚Äì18. <a href="https://doi.org/10.18637/jss.v040.i08">https://doi.org/10.18637/jss.v040.i08</a>.
</div>
<div id="ref-hornik01" class="csl-entry">
Hornik, Kurt. 2001. <span>‚ÄúCxx: <span>C</span>++ Test.‚Äù</span> <a href="https://cran.r-project.org/src/contrib/Archive/cxx/">https://cran.r-project.org/src/contrib/Archive/cxx/</a>.
</div>
<div id="ref-go24" class="csl-entry">
The Go Authors. 2024. <span>‚ÄúGo <span>Modules</span>
<span>Reference</span>.‚Äù</span> <a href="https://go.dev/ref/mod">https://go.dev/ref/mod</a>.
</div>
<div id="ref-cpp1125" class="csl-entry">
Vaughan, Davis, Jim Hester, and Romain Fran√ßois. 2025. <em>‚ÄòCpp11‚Äò: A
<span>C++</span>11 Interface for <span>R</span>‚Äôs c Interface</em>. <a href="https://CRAN.R-project.org/package=cpp11">https://CRAN.R-project.org/package=cpp11</a>.
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script></div>
        <footer><p id="last-updated">Loading...</p>
</footer><script src="../js/footer.js"></script><script src="../js/theme.js"></script><script src="../js/search.js"></script><script src="../js/fontsize.js"></script></div>
</div>
</div>
</body></html>

